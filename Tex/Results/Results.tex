\chapter{Evaluation}
\label{ch:results}
\rm
In diesem Kapitel wird eine Bewertung der heterongenen Architektur auf Grundlage der Erkenntnisse der einzelnen Prozessorkerne geschehen. Zu diesem Zweck wird zuerst ein Überblick über die zur Bewertung herangezogenen Metriken, sowie die Sammlung der hierfür verwendeten Daten gegeben. Also nächstes werden der ARM Cortex A8 und der C674x DSP auf Grundlage dieser Metriken bewertet, bevor eine Bewertung des heterogenen Systems bestehend aus beiden Prozessoren geschieht. Abschließend wird ein Fazit über die gesammelten Erkenntnisse gegeben.

\section{Einführung der Bewertungsmetriken}\label{sec:eveinf}
Für die Bewertung der Optimierungen und der Einsatzmöglichkeit der Untersuchten Architekturen zur Musikklassifikation wird die Betrachtung der Laufzeit um folgende Metriken erweitert:

\begin{itemize}
\item Extraktionsrate
\item Energieeffizienz
\end{itemize}

\paragraph*{Extraktionsrate}$\;$ \\

Als Extraktionsrate $R_{ex}$ ist das Verhältnis von der Anzahl verarbeiteter Fenster $L$ pro Zeiteinheit $t$ (vgl. \textbf{Formel \ref{eqn:er}}).

\begin{equation}
\label{eqn:er}
R_{ex}~=~\frac{L}{t}~=~\frac{t}{T_{Fenster}}
\end{equation}

Die Extraktionsrate hilft Merkmale zu vergleichen, deren Gesamtverarbeitungszeiten für unterschiedliche Fensteranzahlen gemessen wurden.\\
In dieser Arbeit entspricht $t$ gleich einer Sekunde.

\paragraph*{Energieeffizienz}$\;$ \\

Die Energieeffizienz $E_{eff}$ wird allgemein als Kosten-Nutzen-Maß verwendet, also als Verhältnis von aufzubringender Energie, die für die Verrichtung einer definierten Aufgabe benötigt wird.\\
In dieser Arbeit ist die Energie-Effizienz als verarbeitete Fenster $L$ pro Energie $E$ definiert. Sie lässt sich als Verhältnis der Extraktionsrate $R_{ex}$ und dem Leistungsverbrauch $P$ in Watt berechnet (vgl. \textbf{Formel \ref{eqn:en}}).

\begin{equation}
\label{eqn:en}
E_{eff}~=~\frac{R_{ex}}{P}~=~\frac{\frac{L}{t}}{\frac{E}{t}}~=~\frac{L}{E}
\end{equation}

Der Leistungsverbrauch der beiden Prozessorkerne wird aus \cite{power} entnommen. Der ARM Cortex A8 kommt dabei auf einen Leistungsverbrauch von 169 mW und der C674x auf einen zusätzlichen Leistungsverbrauch von 141 mW, so dass das heterogene System auf einen Leistungsverbrauch von 310 mW kommt.

\section{Evaluation der ARM-Optimierung}\label{sec:evarm}

Zunächst werden die Laufzeitverbesserungen betrachtet, die mit den im vorherigen Kapitel beschrieben Optimierungen für die vier Musikklassifikationsmethoden erreicht werden (vgl. \textbf{Abbildung \ref{fig:optarm}}).
%%
%\begin{figure}[h]
%	\centering
%		\includegraphics[width=1\textwidth]{../Pictures/opt.pdf}
%	\caption{Laufzeitverbesserungen der Musikklassifikationsmethoden MCL1 - MCL4}
%	\label{fig:optarm}
%\end{figure} 
%%
Die Rechenzeit von MCL1 wird um 93\% beschleunigt, die von MCL2 um 84\%, die von MCL3 um 61\% und die von MCL4 um 94\%.\\
Aus den Verarbeitungszeiten der Extraktion $T_{total}$ werden die Extraktionszeiten pro Fenster nach \textbf{Formel \ref{eqn:fenster}} berechnet.

\begin{equation}
\label{eqn:fenster}
T_{Fenster}~=~\frac{T_{total}}{L_{total}}
\end{equation}

In \textbf{Abbildung \ref{fig:erarm}} sind die Extraktionsraten pro FeatureSet für die höchste Optimierung des AMR Cortex A8 zu sehen. 

%
\begin{figure}[htp]
	\centering
		\includegraphics[width=1\textwidth]{../Pictures/erarm.pdf}
	\caption{Extraktionsraten pro FeatureSet des ARM Cortex-A8}
	\label{fig:erarm}
\end{figure} 
%
Aus \textbf{Abbildung \ref{fig:enarm}} sind die Energie-Effizienzen pro FeatureSet entnehmbar. Die Energie-Effzienzen von Prozessierung und Klassifikation können pro Musikklassifikationsmethode als konstant anzunehmen. 
%
\begin{figure}[htp]
	\centering
		\includegraphics[width=1\textwidth]{../Pictures/enarm.pdf}
	\caption{Energieeffizienz der einzelnen FeatureSets auf dem ARM Cortex-A8}
	\label{fig:enarm}
\end{figure} 
%
Es zeigt sich, dass FSet 3 und damit MCL3 am energie-effizientesten verarbeitet wird. \textbf{Abbildung \ref{fig:enarm2}} zeigt die Energie-Effizienz pro FeatureSet vor und nach der Optimierung. Hierbei wird die Energie-Effizienz in Relation zur benötigten Laufzeit betrachtet.

\subsection{Weitere Optimierungspotenziale}\label{subsec:armwopt}
Für eine weitere Diskussion über das verbleibende Optimierungspotenzial werden an dieser Stelle diejenigen Merkmale betrachtet, die eine höhere Laufzeit als der hoch-optimierte FFT-Algorithmus aufweisen (vgl. \textbf{Abbildung \ref{fensterfset}}).\\\\
Das OSC-Merkmal besitzt mit einem Anteil von 57,7\% der Gesamtrechenzeit von FSet2 den größten Rechenaufwand von allen Merkmalen. Hierbei fallen 76\% der Laufzeit auf die Sortierung. Für diese werden die SIMD-Eigenschaften der NEON-SIMD-Einheit nicht genutzt, stattdessen werden alle Daten-Vergleiche während der Sortierung sequentiell durchgeführt. Maximal können zwei Daten-Vergleiche auf einmal vorgenommen werden. Damit lässt sich eine obere Schranke für den maximalen Speedup definieren, der bei einem Faktor von 2 liegt. Somit kann OSC maximal um den Faktor 1,6 beschleunigt werden. Jedoch wird selbst mit dieser Beschleunigung das OSC-Merkmal weiterhin die höchste Laufzeit aufweisen.  
\\\\
Mit 37,6\% ist die DCT der zeitintensivste Schritt der MFCC-Extraktion, welche insgesamt 16\% der Gesamtlaufzeit bei FSet1 erfordert. Hierbei kann eine Optimierung ähnlich wie bei der Anwendung der Filterbank durchgeführt werden, welche einen Speedup von 1,2 erreicht hat. Allerdings muss hierfür der DCT-Algorithmus der verwendeten Adress-Arithmetik geändert werden. Hierdurch kann der MFCC-Algorithmus maximal um 6,7\% beschleunigt werden.\\\\
Das ZCR-Merkmal nimmt 86\% der Laufzeit von FSet3 in Anspruch. Dies ist zu 90\% durch die Signum-Funktion verursacht, welche sich aufgrund der datenabhängigen Programmverzweigungen nicht durch SIMD-Instruktionen beschleunigen lässt. Somit ist das Optimierungspotenzial als äußerst gering zu bewerten.

\section{Evaluation der DSP-Optimierung}\label{sec:evdsp}
Als erstes werden die Laufzeitverbesserungen pro Musikklassifikationsmethode betrachtet, die durch die beschriebenen Optimierungen erreicht werden (vgl. \textbf{Abbildung \ref{fig:optdsp}}.

Aus diesen Laufzeiten werden im Anschluss die Extraktionszeiten berechnet, diese sind \textbf{Abbildung \ref{fig:erdsp}} zu entnehmen.
%
\begin{figure}[htp]
	\centering
		\includegraphics[width=1\textwidth]{../Pictures/erdsp.pdf}
	\caption{Extraktionsraten pro FeatureSet des C674x DSP}
	\label{fig:erdsp}
\end{figure} 
%
Auf Basis dieser Extraktionszeiten wird die Energie-Effizienz der einzelnen FeatureSets berechnet (vgl. \textbf{Abbildung \ref{fig:endsp}}). Auch hier ist erkennbar, dass FSet3 das energie-effizienteste ist.\\
%
\begin{figure}[htp]
	\centering
		\includegraphics[width=1\textwidth]{../Pictures/endsp.pdf}
	\caption{Energie-Effizienz der einzelnen FeatureSets auf dem C674x DSP}
	\label{fig:endsp}
\end{figure} 
%
Abschließend werden auch hier die Energie-Effizienzen im Verhältnis zur Verarbeitungszeit betrachtet.


\subsection{Weitere Optimierungspotenziale}\label{subsec:dspwopt}

Für weitere Diskussionen über das verbleibende Optimerungspotenzial werden nur Algorithmen betrachtet, die eine Laufzeit von über 10 ms besitzen (vgl. \textbf{Abbildung \ref{fig:potdsp}}).

Bei der MAG-Berechnung sind Divison und Wurzelberechnung bereits optimiert worden. Auch die Addition wurde bereits für SPLOOP optimiert. Eine weitere Optimierum könnte einzig bei der Addition geschehen. Das Optimierungspotenzial in diese Richtung ist aber eher als gering zu bewerten.

Bei der Berechnung des MFCC-Merkmals wurde bereits die Logarithmierung optimiert. Eine weitere Optimierung wäre nur noch in Richtung DCT  und der Anwendung der Filterbank möglich. Hierbei hat die Anwendung der Filterbank mit 73,7\% den größten Anteil an der Rechenzeit. ...

Die Berechnung des OSC-Merkmals wurde bereits hinsichtlich der Sortierung optimiert. ...

\section{Evaluation heterogenes System}\label{sec:evhetsys}

Für die Evaluation des heterogenen Systems wird angenommen, dass die drei Schritte der Musikklassifikation Extraktion, Prozessierung und Klassifikation nacheinander ausgeführt und dabei so auf die beiden Prozessorkerne verteilt werden, dass die Extraktion vom C674x DSP und die beiden anderen Schritte vom ARM Cortex A8 ausgeführt werden. Zu den Rechenzeiten dieser drei Schritte muss zusätzlich noch die Kommunikationszeit zwischen ARM und DSP betrachtet werden. Diese Kommunikationszeit wurde pro extrahiertem Musikstück zu 4 ms gemessen.\\
Die Laufzeitunterschiede zwischen der Verwendung dem DSP-Referenz-Programm-Code und der optimierten DSP-Implementation ist in \textbf{Abbildung \ref{fig:hete}} zu sehen. Hierbei werden die Musikklassifikationsmethoden 1-4 um die Faktoren 8,5, 4,2, 2,1 und 7,2 beschleunigt.


\section{Gegenüberstellung ARM und ARM+DSP}\label{sec:evarmdsp}
\textbf{Abbildung \ref{fig:hete+arm}} zeigt den Laufzeitunterschied zwischen Referenz-Programm-Code und optimierter Version auf dem ARM und dem unoptimierten und optimierten heterogenen System.\\
Aus der Abbildung wird ersichtlich, dass in den Vergleichen zwischen ARM und ARM+DSP der heterogene Ansatz für jede Musikklassifikationsmethode trotz Kommunikationszeit die geringeren Laufzeiten aufweist. Dieses ist auch in den Extraktionsraten zu erkennen (vgl. \textbf{Abbildung \ref{fig:erhete}}.\\
Bei der Betrachtung der Energie-Effizienz beider Ansätze erkennt man, dass hier der ARM Cortex A8 die besseren Ergebnisse liefert (vgl. \textbf{Abbildung \ref{fig:enhete}}).



\section{Fazit}\label{sec:evfaz}

Es wird erkenntlich, dass beide betrachteten Architekturen ihre Vor- und Nachteile haben. Außerdem wird ersichtlich, dass die beiden Ziele Laufzeit und Energie-Effizienz nicht gemeinsam erreichbar sind.\\
Soll ein System mit möglichst geringer Laufzeit erstellt werden, ist der heterogene Ansatz vorzuziehen. Nach den im vorherigen Kapitel durchgeführten Optimierungen auf ARM und DSP wird eine Musikklassifikation auf dem heterogenen System um \% schneller ausgeführt als auf dem ARM Cortex A8.\\
Wird allerdings ein Energie-effizientes System verlangt, so ist der ARM Cortex A8 vorzuziehen. Die Energie-Effiziens ist um \% höher als die des heterogenen Systems.